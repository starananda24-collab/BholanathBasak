<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INDIA BADSAH</title>
<style>
/* Your existing CSS remains unchanged */
body {margin:0; font-family: Arial, sans-serif; background:linear-gradient(to right,#1a2a6c,#b21f1f,#fdbb2d); color:white; line-height:1.6;}
header{text-align:center; padding:20px; background:rgba(0,0,0,0.6);}
header img{width:180px;height:180px;object-fit:cover;border-radius:50%;border:5px solid #fff;transition: transform 0.4s;}
header img:hover{transform: scale(1.05) rotate(2deg);}
header h1{margin:15px 0 0; font-size:2.5em;color:#fbd46d;text-shadow:2px 2px 5px black;}
nav{display:flex;justify-content:center;background:rgba(0,0,0,0.8);flex-wrap:wrap;align-items:center;}
nav a{color:white;text-decoration:none;padding:10px 15px;display:block;transition:background 0.3s,color 0.3s;cursor:pointer;}
nav a:hover{background:#fbd46d;color:black;border-radius:5px;}
#statusSearch {margin-left:10px;padding:5px;border-radius:5px;border:none;}
#statusResult {margin-left:10px;}
section{padding:40px 20px;max-width:900px;margin:auto;background:rgba(255,255,255,0.1);margin-bottom:30px;border-radius:12px;box-shadow:0px 4px 15px rgba(0,0,0,0.5);}
section h2{color:#ffe66d;margin-bottom:15px;}
.form-box{background:rgba(0,0,0,0.7);padding:20px;border-radius:12px;color:white;max-width:500px;margin:auto;}
.form-box label{display:block;margin-bottom:10px;}
.form-box input, .form-box select{width:100%;padding:5px;margin-top:3px;border-radius:5px;border:none;}
.btn{background:#fbd46d;color:black;padding:8px 12px;border:none;border-radius:5px;cursor:pointer;margin-top:10px;}
.btn:hover{background:white;}
table{width:100%;border-collapse:collapse;color:black;background:white;margin-top:20px;}
table, th, td{border:1px solid #000;}
th, td{padding:8px;text-align:center;}
.green{background:#28a745;color:white;}
.red{background:#dc3545;color:white;}
.pink{background:#ff69b4;color:white;}
.yellow{background:#ffc107;color:white;}
.grey{background:#6c757d;color:white;}
.deep-green{background:#196619;color:white;}
.deep-red{background:#8b0000;color:white;}
.hidden{display:none;}
@media (max-width: 600px) {
  .form-box input, .form-box select, .form-box button {width:100% !important; font-size:16px; margin-top:5px;}
  nav {flex-direction: column; align-items: flex-start;}
  #statusSearch {width:90%; margin:10px;}
}
</style>
<!-- Firebase SDK + jsPDF -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, getDocs, updateDoc, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
import { jsPDF } from "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";

const firebaseConfig = {
  apiKey: "AIzaSyCRWKawtRjDB_BdlrfjrjTlxwwaOKKsvp4",
  authDomain: "india-badsah-appointments.firebaseapp.com",
  projectId: "india-badsah-appointments",
  storageBucket: "india-badsah-appointments.appspot.com",
  messagingSenderId: "702606567712",
  appId: "1:702606567712:web:70e249801ca363f0d14f45",
  measurementId: "G-DYNTWSL6GT"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);

// ------------------- Section Show -------------------
function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
window.showSection = showSection;

// ------------------- Generate Appointment Number -------------------
async function getNextAppointmentNumber() {
  const q = query(collection(db,"visitors"), orderBy("apptNoNum","desc"), limit(1));
  const snapshot = await getDocs(q);
  let lastNum = 0;
  snapshot.forEach(doc => { lastNum = doc.data().apptNoNum; });
  return {apptNo:"APMTWBNB" + String(lastNum+1).padStart(2,"0"), num:lastNum+1};
}

// ------------------- Submit Visitor Form -------------------
async function submitVisitorForm(e){
  e.preventDefault();
  let name = document.getElementById("vname").value.trim();
  let date = document.getElementById("vdate").value;
  let time = document.getElementById("vtime").value;
  let phone = document.getElementById("vphone").value.trim();
  if(!name || !date || !time || !phone){ alert("Please fill mandatory fields"); return; }

  const {apptNo, num} = await getNextAppointmentNumber();

  await addDoc(collection(db,"visitors"),{
    apptNo, apptNoNum:num, name, date, time,
    phone:document.getElementById("ccode").value + phone,
    address:document.getElementById("vaddress").value,
    country:document.getElementById("vcountry").value,
    dob:document.getElementById("vdob").value,
    purpose:document.getElementById("vpurpose").value,
    passport:document.getElementById("vpassport").value||"NA",
    email:document.getElementById("vemail").value+document.getElementById("emaildomain").value,
    status:"Pending", chat:[], submitted:new Date().toLocaleString()
  });

  alert("Appointment sent successfully: "+apptNo);
  document.getElementById("appointmentForm").reset();
}
document.getElementById("appointmentForm").addEventListener("submit", submitVisitorForm);

// ------------------- Visitor Status -------------------
async function checkStatus() {
  const apptNo = document.getElementById("statusSearch").value.trim();
  const snapshot = await getDocs(collection(db,"visitors"));
  let found = false;
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    if(data.apptNo === apptNo){
      found = true;
      let colorClass = "pink";
      if(data.status==="Accepted") colorClass="green";
      else if(data.status==="Rejected") colorClass="red";

      document.getElementById("statusResult").innerHTML = `
      <div style="padding:15px;border-radius:8px;background:white;color:black;">
        <p><strong>Appt No:</strong> ${data.apptNo}</p>
        <p><strong>Name:</strong> ${data.name}</p>
        <p><strong>Visit Date:</strong> ${data.date}</p>
        <p><strong>Visit Time:</strong> ${data.time}</p>
        <p><strong>Phone:</strong> ${data.phone}</p>
        <p><strong>Status:</strong> <button class="${colorClass}">${data.status}</button></p>
      </div>`;
    }
  });
  if(!found) document.getElementById("statusResult").innerHTML = "❌ No Appointment Found";
}
window.checkStatus = checkStatus;

// ------------------- Admin Dashboard -------------------
async function renderTable(){
  const tbody = document.querySelector("#visitorTable tbody");
  tbody.innerHTML="";
  const snapshot = await getDocs(collection(db,"visitors"));
  snapshot.forEach(docSnap=>{
    const v = docSnap.data();
    let colorClass = "pink";
    if(v.status==="Accepted") colorClass="green";
    else if(v.status==="Rejected") colorClass="red";

    const row = document.createElement("tr");
    row.innerHTML = `<td>${v.apptNo}</td><td>${v.name}</td><td>${v.date}</td><td>${v.time}</td><td>${v.phone}</td><td>${v.purpose}</td>
      <td><button class="${colorClass}">${v.status}</button></td>
      <td>
        <button onclick="updateStatus('${docSnap.id}','Accepted')" ${v.status!=="Pending"?'disabled':''}>Accept</button>
        <button onclick="updateStatus('${docSnap.id}','Rejected')" ${v.status!=="Pending"?'disabled':''}>Reject</button>
      </td>`;
    tbody.appendChild(row);
  });
}
window.renderTable = renderTable;

async function updateStatus(docId,status){
  const ref = doc(db,"visitors",docId);
  await updateDoc(ref,{status});
  renderTable();
}
</script>
</head>
<body>
<header>
  <img src="myphoto.jpg" alt="India Badsah Photo">
  <h1>INDIA BADSAH</h1>
</header>

<nav>
  <a onclick="showSection('profile')">Profile</a>
  <a onclick="showSection('visitor')">Visitor Form</a>
  <input type="text" id="statusSearch" placeholder="Visitor Status: Enter Appt No" onkeypress="if(event.key==='Enter'){checkStatus();}">
</nav>

<section id="profile"><h2>Profile</h2><p>I am INDIA BADSAH, passionate learner...</p></section>

<section id="visitor" class="hidden">
  <h2>E_Appointment Visitor Form</h2>
  <form id="appointmentForm" class="form-box">
    <label>Visitor Name* <input type="text" id="vname" required></label>
    <label>Visitor Address <input type="text" id="vaddress"></label>
    <label>From Country <input type="text" id="vcountry"></label>
    <label>Date of Birth <input type="date" id="vdob"></label>
    <label>Virtual Visit Date* <input type="date" id="vdate" required></label>
    <label>Time Availability* <input type="time" id="vtime" required></label>
    <label>Contact Number* 
      <select id="ccode">
        <option value="+91">India (+91)</option>
        <option value="+1">USA (+1)</option>
        <option value="+880">Bangladesh (+880)</option>
        <option value="+92">Pakistan (+92)</option>
        <option value="+94">Sri Lanka (+94)</option>
      </select>
      <input type="tel" id="vphone" required>
    </label>
    <label>Purpose of Visit
      <select id="vpurpose">
        <option value="Visit Abroad">Visit Abroad</option>
        <option value="Student Visa in Abroad">Student Visa in Abroad</option>
      </select>
    </label>
    <label>Passport Number <input type="text" id="vpassport"></label>
    <label>Email ID <input type="text" id="vemail" placeholder="yourname" required>
      <select id="emaildomain"><option value="@gmail.com">@gmail.com</option></select>
    </label>
    <button type="submit" class="btn">Submit</button>
  </form>
</section>

<section id="adminDashboard" class="hidden">
  <h2>Admin Dashboard</h2>
  <button onclick="renderTable()" class="btn">Refresh</button>
  <table id="visitorTable">
    <thead><tr>
      <th>Appt No</th><th>Name</th><th>Date</th><th>Time</th><th>Phone</th><th>Purpose</th><th>Status</th><th>Action</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</section>

<div id="statusResult"></div>
</body>
</html>
